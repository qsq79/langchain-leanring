# 需求规格说明书 - 多智能体客服系统

## 1. 项目概述

### 1.1 背景

当前客服系统需要处理大量关于订单状态和物流信息的用户查询。传统方式需要人工查询多个系统接口，效率低下且容易出错。基于 AutoGen 框架的多智能体客服系统可以通过多个专门智能体协同工作，自动化处理这些查询请求，提高响应速度和准确性。

### 1.2 目标

构建一个基于多智能体技术的客服系统，实现：
- 自动化处理用户关于订单状态和物流信息的查询
- 通过多个智能体协同工作完成复杂查询任务
- 提供用户友好的智能回复
- 提高客服响应效率和准确性

### 1.3 范围

**包含内容：**
- 订单状态查询功能
- 物流信息查询功能
- 多智能体协同处理机制
- 智能回复生成功能
- 智能体交互过程可视化

**不包含内容：**
- 用户身份认证和授权
- 订单创建、修改、取消等功能
- 用户历史查询记录存储
- 多渠道接入（仅支持命令行界面）

## 2. 功能需求

### 2.1 用户角色

| 角色名称 | 描述 | 权限 |
|----------|------|------|
| 客服用户 | 提出订单和物流相关查询的用户 | 发起查询请求、查看智能体交互过程、获取查询结果 |

### 2.2 功能清单

#### 2.2.1 订单状态查询功能

- **需求ID**: FR-001
- **需求描述**: 系统应能够根据用户提供的订单编号，查询并返回该订单的详细状态信息，包括订单创建时间、当前状态、支付状态、发货状态等
- **优先级**: 高
- **验收标准**: 
  - 能够接收订单编号作为输入
  - 返回完整的订单状态信息（JSON格式）
  - 订单数据来源于模拟的内部系统API
- **依赖关系**: 无

#### 2.2.2 物流信息查询功能

- **需求ID**: FR-002
- **需求描述**: 系统应能够根据订单编号查询该订单的物流跟踪信息，包括物流状态、运输轨迹、预计送达时间等
- **优先级**: 高
- **验收标准**: 
  - 能够接收订单编号作为输入
  - 返回完整的物流跟踪信息（JSON格式）
  - 物流数据来源于模拟的内部系统API
- **依赖关系**: 无

#### 2.2.3 多智能体协同处理功能

- **需求ID**: FR-003
- **需求描述**: 系统应包含三个专门智能体，分别负责订单查询、物流查询和结果汇总，智能体之间能够通过定义的通信协议进行协同工作
- **优先级**: 高
- **验收标准**: 
  - 系统包含订单查询智能体、物流查询智能体、结果汇总智能体
  - 智能体之间能够交换数据和协调任务
  - 智能体按照预定的顺序和逻辑完成查询任务
- **依赖关系**: FR-001, FR-002

#### 2.2.4 智能回复生成功能

- **需求ID**: FR-004
- **需求描述**: 系统应能够整合订单状态和物流信息，生成用户友好的自然语言回复，直接回答用户的问题
- **优先级**: 高
- **验收标准**: 
  - 能够理解用户的查询意图
  - 整合来自不同智能体的结果信息
  - 生成清晰、易懂的自然语言回复
  - 回复内容能够准确回答用户问题
- **依赖关系**: FR-001, FR-002, FR-003

#### 2.2.5 智能体交互过程可视化

- **需求ID**: FR-005
- **需求描述**: 系统应能够实时显示智能体之间的交互过程，包括消息传递、任务分配、结果汇总等，以便用户了解系统的工作原理和执行过程
- **优先级**: 中
- **验收标准**: 
  - 能够显示智能体之间的通信消息
  - 能够显示每个智能体的任务执行状态
  - 能够以清晰的方式展示完整的工作流程
- **依赖关系**: FR-003

#### 2.2.6 接口调用重试功能

- **需求ID**: FR-006
- **需求描述**: 系统应能够处理API调用失败的情况，采用指数级退避策略自动重试失败的请求，提高系统的稳定性
- **优先级**: 高
- **验收标准**: 
  - 能够检测API调用失败
  - 采用指数级退避策略进行重试
  - 重试次数可配置
  - 在重试失败后提供清晰的错误信息
- **依赖关系**: FR-001, FR-002

#### 2.2.7 用户查询输入功能

- **需求ID**: FR-007
- **需求描述**: 系统应提供用户输入查询问题的接口，支持命令行参数输入和交互式输入两种方式
- **优先级**: 中
- **验收标准**: 
  - 支持通过命令行参数传递查询问题
  - 支持交互式输入方式，用户可以在运行时输入查询问题
  - 能够解析并处理不同格式的用户输入
- **依赖关系**: 无

## 3. 用户故事

### 3.1 用户查询订单发货状态

**作为** 客服用户
**我想要** 查询我的订单为什么还没发货
**以便于** 了解订单的当前状态和发货情况

**验收条件**:
* 用户能够输入订单相关问题（如"我的订单ORD001为什么还没发货？"）
* 系统能够识别订单编号
* 系统能够查询订单状态和物流信息
* 系统能够生成清晰的自然语言回复，说明订单的当前状态和发货预期
* 用户能够看到智能体的交互过程

### 3.2 用户查询物流信息

**作为** 客服用户
**我想要** 查询我的订单的物流跟踪信息
**以便于** 了解包裹的当前位置和预计送达时间

**验收条件**:
* 用户能够查询物流信息
* 系统能够返回完整的物流跟踪数据
* 系统能够以用户友好的方式展示物流轨迹和预计送达时间
* 用户能够通过可视化界面查看智能体的工作过程

### 3.3 系统处理接口调用失败

**作为** 系统
**我想要** 当内部接口调用失败时自动重试
**以便于** 提高系统的稳定性和可靠性

**验收条件**:
* 系统能够检测接口调用失败
* 系统能够采用指数级退避策略自动重试
* 系统在重试一定次数后仍然失败时，能够返回适当的错误信息
* 用户能够看到重试过程的相关信息

## 4. 数据需求

### 4.1 数据实体

- **订单信息**: 包含订单编号、创建时间、订单状态、支付状态、发货状态等
- **物流信息**: 包含物流状态、运输节点、预计送达时间、当前位置等

### 4.2 数据流

1. 用户发起查询请求
2. 系统解析查询内容，识别订单编号
3. 订单查询智能体调用订单状态API获取订单信息
4. 物流查询智能体调用物流信息API获取物流数据
5. 结果汇总智能体接收并整合两个智能体的返回结果
6. 结果汇总智能体生成自然语言回复
7. 系统向用户返回最终回复，并展示智能体交互过程

## 5. 假设和依赖

### 5.1 假设

- **假设1**: 系统运行环境能够访问OpenAI API（如果需要使用语言模型）
- **假设2**: 内部系统API在模拟环境中稳定运行
- **假设3**: 用户提供的订单编号格式正确且有效
- **假设4**: 用户能够通过命令行界面与系统交互

### 5.2 依赖

- **依赖1**: AutoGen框架（用于构建多智能体系统）
- **依赖2**: FastAPI（用于模拟内部系统API）
- **依赖3**: OpenAI API（可选，用于智能对话生成）
- **依赖4**: 网络连接（用于调用内部API和外部服务）

## 6. 智能体定义

### 6.1 订单查询智能体（Agent A）

**职责**: 
- 接收查询请求中的订单编号
- 调用订单状态API获取订单详细信息
- 将订单信息传递给结果汇总智能体

**输入**: 订单编号
**输出**: 订单详细状态信息（JSON格式）

### 6.2 物流查询智能体（Agent B）

**职责**: 
- 接收查询请求中的订单编号
- 调用物流信息API获取物流跟踪数据
- 将物流信息传递给结果汇总智能体

**输入**: 订单编号
**输出**: 物流跟踪信息（JSON格式）

### 6.3 结果汇总智能体（Agent C）

**职责**: 
- 接收订单查询智能体和物流查询智能体的返回结果
- 理解用户的原始查询意图
- 整合订单状态和物流信息
- 生成用户友好的自然语言回复

**输入**: 用户查询意图、订单状态信息、物流信息
**输出**: 自然语言回复字符串

## 7. 业务场景示例

### 7.1 场景一：查询订单发货延迟

**用户提问**: "我的订单ORD001为什么还没发货？"

**系统处理流程**:
1. 订单查询智能体查询订单ORD001的状态，返回"已支付，待发货"
2. 物流查询智能体查询订单ORD001的物流信息，返回"暂无物流信息，订单未发货"
3. 结果汇总智能体整合信息，生成回复："您的订单ORD001已经完成支付，但尚未发货。当前订单状态为'待发货'，请您耐心等待，我们会尽快为您安排发货。"

### 7.2 场景二：查询物流跟踪

**用户提问**: "我的订单ORD002的物流状态如何？"

**系统处理流程**:
1. 订单查询智能体查询订单ORD002的状态，返回"已发货"
2. 物流查询智能体查询订单ORD002的物流信息，返回"物流进行中，当前到达北京转运中心，预计3天后送达"
3. 结果汇总智能体整合信息，生成回复："您的订单ORD002已发货，物流状态为'运输中'。包裹当前到达北京转运中心，预计3天后送达您手中。"